<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Test</title>

    <style>
      .box {
        margin: 5px;
        padding: 5px;
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <div>Schedules</div>
    <div id="schedules">
      <!-- <div class="box">
        <div><strong>Title</strong></div>
        <div>May 20, 2023</div>
        <hr />
        <div>description</div>
      </div> -->
    </div>
  </body>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();

    socket.on("onchange", (data) => {
      console.log("FORM SOCKETIO:", data);
      loadData();
    });

    function loadData() {
      fetch("http://localhost:1337/api/games", {
        method: "GET",
        redirect: "follow",
      })
        .then((response) => response.text())
        .then((result) => {
          console.log(JSON.parse(result));
          displayData(JSON.parse(result).data);
        })
        .catch((error) => console.log("error", error));

      function displayData(data) {
        var content = "";

        data.map((game) => {
          if (game.attributes.status) {
            let parseDate = new Date(game.attributes.schedule)
              .toISOString()
              .replace(/T/, " ")
              .replace(/\..+/, "");

            content += `
            <div class="box">
                <div><strong>${game.id}: ${game.attributes.title}</strong></div>
                <div>${parseDate}</div>
                <hr />
                <div><i>${game.attributes.description}</i></div>
                <div> ${game.attributes.status}</div>
            </div>
            `;
          }
        });

        document.getElementById("schedules").innerHTML = content;
      }
    }

    //initialize data
    loadData();
  </script>
</html>
